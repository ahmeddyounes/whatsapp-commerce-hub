id,title,spec
M00-01,"Plugin Bootstrap & File Structure","Create the main plugin file and directory structure for WhatsApp Commerce Hub. Create main file 'whatsapp-commerce-hub.php' with plugin header (Plugin Name: WhatsApp Commerce Hub, Description: Complete e-commerce ecosystem inside WhatsApp with WooCommerce sync, Version: 1.0.0, Requires PHP: 8.1, Requires at least: 6.0, WC requires at least: 8.0). Directory structure: /includes (core classes), /admin (admin UI), /public (frontend), /assets/css, /assets/js, /assets/images, /templates (message templates), /languages (i18n). Implement singleton pattern for main plugin class WCH_Plugin with getInstance(). Add activation hook to check PHP 8.1+, WordPress 6.0+, WooCommerce 8.0+ dependencies - show admin notice and deactivate if missing. Add deactivation hook for cleanup. Register autoloader using spl_autoload_register for WCH_ prefixed classes mapping to /includes directory. Define constants: WCH_VERSION, WCH_PLUGIN_DIR, WCH_PLUGIN_URL, WCH_PLUGIN_BASENAME. Initialize plugin on 'plugins_loaded' hook priority 20 (after WooCommerce). Acceptance criteria: Plugin activates without errors, autoloader loads classes correctly, dependency check prevents activation on incompatible systems, all constants accessible globally."
M00-02,"Database Schema & Migration System","Create database migration system and initial schema. Create class WCH_Database_Manager with methods: install(), uninstall(), get_table_name($table), run_migrations(). Use dbDelta() for table creation. Tables to create: wch_conversations (id BIGINT AUTO_INCREMENT, customer_phone VARCHAR(20) INDEX, wa_conversation_id VARCHAR(100), status ENUM pending/active/closed, assigned_agent_id BIGINT NULL, context JSON, last_message_at DATETIME, created_at DATETIME, updated_at DATETIME). wch_messages (id BIGINT AUTO_INCREMENT, conversation_id BIGINT FOREIGN KEY, direction ENUM inbound/outbound, message_type ENUM text/interactive/image/document/template, wa_message_id VARCHAR(100) UNIQUE, content JSON, status ENUM sent/delivered/read/failed, created_at DATETIME INDEX). wch_carts (id BIGINT AUTO_INCREMENT, customer_phone VARCHAR(20) UNIQUE, items JSON, coupon_code VARCHAR(50) NULL, shipping_address JSON NULL, expires_at DATETIME INDEX, created_at DATETIME, updated_at DATETIME). wch_customer_profiles (id BIGINT AUTO_INCREMENT, phone VARCHAR(20) UNIQUE, wc_customer_id BIGINT NULL INDEX, name VARCHAR(100), saved_addresses JSON, preferences JSON, opt_in_marketing TINYINT DEFAULT 0, created_at DATETIME, updated_at DATETIME). wch_broadcast_campaigns (id BIGINT AUTO_INCREMENT, name VARCHAR(200), template_name VARCHAR(100), audience_filter JSON, status ENUM draft/scheduled/sending/completed/failed, scheduled_at DATETIME NULL, sent_count INT DEFAULT 0, delivered_count INT DEFAULT 0, read_count INT DEFAULT 0, created_at DATETIME, updated_at DATETIME). wch_sync_queue (id BIGINT AUTO_INCREMENT, entity_type ENUM product/order/inventory, entity_id BIGINT, action ENUM create/update/delete, status ENUM pending/processing/completed/failed, attempts INT DEFAULT 0, error_message TEXT NULL, created_at DATETIME INDEX, processed_at DATETIME NULL). Store schema version in wp_options as 'wch_db_version'. Run migrations on plugin activation and admin_init if version mismatch. Acceptance criteria: All tables created with proper indexes and foreign keys, migrations are idempotent, uninstall removes all tables when 'WCH_REMOVE_DATA' constant is true."
M00-03,"Settings Framework & Options Management","Create centralized settings management system. Create class WCH_Settings with methods: get($key, $default), set($key, $value), get_all(), delete($key), get_section($section). Store all settings in single wp_option 'wch_settings' as serialized array for atomic updates. Setting sections and keys: 'api' section (whatsapp_phone_number_id, whatsapp_business_account_id, access_token [encrypted], webhook_verify_token, api_version DEFAULT 'v18.0'). 'general' section (enable_bot BOOL, business_name, welcome_message, fallback_message, operating_hours JSON, timezone). 'catalog' section (sync_enabled BOOL, sync_products ARRAY of product IDs or 'all', include_out_of_stock BOOL, price_format, currency_symbol). 'checkout' section (enabled_payment_methods ARRAY, cod_enabled BOOL, cod_extra_charge FLOAT, min_order_amount FLOAT, max_order_amount FLOAT, require_phone_verification BOOL). 'notifications' section (order_confirmation BOOL, order_status_updates BOOL, shipping_updates BOOL, abandoned_cart_reminder BOOL, abandoned_cart_delay_hours INT). 'ai' section (enable_ai BOOL, openai_api_key [encrypted], ai_model DEFAULT 'gpt-4', ai_temperature FLOAT, ai_max_tokens INT, ai_system_prompt TEXT). Create WCH_Encryption helper class using OpenSSL with wp_salt('auth') as key for encrypting sensitive fields. Provide filter 'wch_settings_defaults' for default values. Acceptance criteria: Settings persist across requests, encrypted fields cannot be read directly from database, get() returns defaults for unset keys, settings validate types on set()."
M00-04,"REST API Base Controller & Authentication","Create REST API infrastructure for admin and external integrations. Register REST namespace 'wch/v1' using register_rest_route in rest_api_init hook. Create abstract class WCH_REST_Controller extending WP_REST_Controller with methods: register_routes() abstract, get_item_schema() abstract, check_admin_permission() returns current_user_can('manage_woocommerce'), validate_phone($phone) returns sanitized E.164 format or WP_Error, prepare_response($data, $request), add_pagination_headers($response, $total, $per_page, $page). Create authentication methods: check_api_key_permission() validates X-WCH-API-Key header against stored hash, check_webhook_signature() validates X-Hub-Signature-256 header using webhook secret. Register endpoints structure: /settings (GET/POST admin), /conversations (GET/POST), /conversations/{id} (GET/PATCH), /conversations/{id}/messages (GET/POST), /customers (GET), /customers/{phone} (GET/PATCH), /analytics (GET), /broadcasts (GET/POST), /broadcasts/{id} (GET/PATCH/DELETE), /webhook (POST public for WhatsApp callbacks). Apply rate limiting using transients: 100 requests/minute for admin endpoints, 1000 requests/minute for webhook. Return standardized error responses with code, message, and details. Acceptance criteria: All endpoints require authentication except webhook, rate limiting blocks excessive requests with 429 response, responses follow WP REST API conventions, OpenAPI/Swagger compatible."
M00-05,"Logging & Error Handling System","Create comprehensive logging system for debugging and audit trails. Create class WCH_Logger with methods: debug($message, $context), info($message, $context), warning($message, $context), error($message, $context), critical($message, $context). Parameters: $message string, $context array with optional keys (conversation_id, customer_phone, order_id, exception). Log storage: Write to custom log file in wp-content/uploads/wch-logs/wch-{date}.log. Rotate logs daily, keep 30 days. Also write errors to standard WooCommerce logger WC_Logger with source 'whatsapp-commerce-hub'. Log format: [TIMESTAMP] [LEVEL] [REQUEST_ID] Message | Context JSON. Generate unique REQUEST_ID per request stored in static variable. Create WCH_Exception extends Exception with additional properties: error_code (string), http_status (int), context (array). Create error handler class WCH_Error_Handler registered on init hook with methods: handle_exception(Throwable), handle_error(errno, errstr, errfile, errline), handle_shutdown(). Convert errors to exceptions in development mode (WP_DEBUG true). Sanitize sensitive data (access tokens, passwords) from logs using regex patterns. Add admin page under WooCommerce > Status > Logs to view WCH logs with filtering by level and date. Acceptance criteria: All plugin operations logged appropriately, sensitive data never appears in logs, logs viewable from admin, old logs auto-deleted, exceptions include stack traces in debug mode."
M00-06,"Background Job Queue Processor","Create async job processing system for long-running tasks. Create class WCH_Queue using Action Scheduler (bundled with WooCommerce). Register action hooks on init: 'wch_process_sync_job', 'wch_send_broadcast_batch', 'wch_cleanup_expired_carts', 'wch_process_abandoned_cart', 'wch_retry_failed_message'. Create WCH_Job_Dispatcher with methods: dispatch($hook, $args, $delay_seconds), dispatch_batch($hook, $items_array, $batch_size), cancel($hook, $args), is_scheduled($hook, $args), get_pending_count($hook). Job handlers to implement: WCH_Sync_Job_Handler for product/order sync with retry logic (max 3 attempts, exponential backoff 60s/300s/900s). WCH_Broadcast_Job_Handler processes broadcast campaigns in batches of 50 recipients with 1 second delay between batches to respect rate limits. WCH_Cart_Cleanup_Handler runs hourly via wch_hourly_cron to delete carts older than 72 hours. WCH_Abandoned_Cart_Handler sends reminder messages for carts idle for configured hours. Create admin UI in Settings > Advanced showing: pending jobs count by type, failed jobs list with retry button, job processing status. Store job results in wch_job_results transient for 1 hour. Acceptance criteria: Jobs process reliably in background, failed jobs retry with backoff, rate limits respected, admin can monitor and retry jobs, no memory exhaustion on large batches."
M01-01,"WhatsApp Cloud API Client","Create HTTP client for WhatsApp Business Cloud API. Create class WCH_WhatsApp_API_Client with constructor accepting config array (phone_number_id, access_token, api_version). Private method request($method, $endpoint, $body) using wp_remote_request with: base URL 'https://graph.facebook.com/{api_version}/', headers (Authorization: Bearer {token}, Content-Type: application/json), timeout 30 seconds, sslverify true. Implement retry logic: 3 attempts with exponential backoff for 5xx errors and rate limit (429) responses. Parse response JSON and throw WCH_API_Exception on errors with Graph API error code and message. Public methods: send_text_message($to, $text, $preview_url), send_interactive_list($to, $header, $body, $footer, $button_text, $sections), send_interactive_buttons($to, $header, $body, $footer, $buttons), send_template($to, $template_name, $language_code, $components), send_image($to, $image_url_or_id, $caption), send_document($to, $document_url_or_id, $filename, $caption), send_product_message($to, $catalog_id, $product_retailer_id), send_product_list($to, $catalog_id, $header, $body, $sections), mark_as_read($message_id), get_media_url($media_id), upload_media($file_path, $mime_type), get_business_profile(), update_business_profile($data). All send methods return array with 'message_id' and 'status'. Phone number validation: must be E.164 format. Log all API requests and responses at debug level. Acceptance criteria: All message types send successfully, rate limits handled gracefully, errors throw typed exceptions, media upload/download works, API responses parsed correctly."
M01-02,"WhatsApp Webhook Handler","Create secure webhook endpoint for receiving WhatsApp events. Create class WCH_Webhook_Handler. Register REST route POST /wch/v1/webhook and GET /wch/v1/webhook (for verification). Implement webhook verification for GET: return hub.challenge if hub.verify_token matches stored token, else 403. For POST requests: Validate X-Hub-Signature-256 header using hash_hmac('sha256', payload, app_secret) - return 401 if invalid. Parse webhook payload and dispatch to appropriate handlers. Webhook event types to handle: 'messages' - new incoming message, 'statuses' - message status update (sent/delivered/read/failed), 'errors' - delivery errors. Create event dispatcher method dispatch_event($type, $data) using do_action('wch_webhook_{$type}', $data). For messages event, extract: from (phone), timestamp, type (text/interactive/image/document/button/location), message content based on type, context (replied message id if reply). For statuses event, extract: message_id, status, timestamp, recipient_id, errors array if failed. Store raw webhook payload in wch_messages table for debugging. Implement idempotency: check if message_id already processed using transient 'wch_msg_{id}' (1 hour TTL). Return 200 OK immediately after validation, process asynchronously using WCH_Queue. Acceptance criteria: Webhook verification works on Meta setup, signature validation rejects tampered requests, duplicate messages ignored, all event types parsed correctly, processing is async."
M01-03,"Message Builder & Template Manager","Create fluent interface for building WhatsApp messages and managing templates. Create class WCH_Message_Builder with fluent methods: text($content), header($type, $content) where type is text/image/document/video, body($text), footer($text), button($type, $data) where type is reply/url/phone/flow, section($title, $rows) for list messages, product($product_id), product_list($product_ids). Method build() returns formatted array for API. Validation in build(): text max 4096 chars, header text max 60 chars, body max 1024 chars for interactive, footer max 60 chars, max 3 buttons for button messages, max 10 sections with 10 rows each for lists. Create WCH_Template_Manager for message templates. Methods: sync_templates() fetches templates from WhatsApp API and stores in option 'wch_message_templates', get_templates() returns cached templates, get_template($name) returns single template, render_template($name, $variables) replaces {{1}}, {{2}} placeholders with values. Template categories to support: order_confirmation, order_status_update, shipping_update, abandoned_cart, promotional. Create admin UI page 'Message Templates' showing: synced templates with status (approved/pending/rejected), preview with variable placeholders, last sync timestamp, sync button. Store template usage stats in transient for analytics. Acceptance criteria: Message builder validates all constraints, templates sync from API, variables render correctly, admin can view and preview templates, invalid messages throw descriptive errors."
M01-04,"Interactive Message Response Parser","Create parser for handling interactive message responses from customers. Create class WCH_Response_Parser with method parse($webhook_message_data) returning WCH_Parsed_Response object. WCH_Parsed_Response properties: type (text/button_reply/list_reply/product_inquiry/location/image/document/unknown), raw_content, parsed_data array. For text messages: extract text body, detect intent keywords (hi/hello=greeting, order/track=order_status, help/support=help, cart/basket=view_cart, checkout/pay=checkout, cancel=cancel). For interactive button_reply: extract button_id and button_title. For interactive list_reply: extract list_id, title, description. For product inquiry (nfm_reply): extract product_retailer_id, catalog_id. For location: extract latitude, longitude, name, address. For image/document: extract media_id, mime_type, sha256, caption. Create intent detection method detect_intent($text) using keyword matching and optional AI enhancement. Intents enum: GREETING, BROWSE_CATALOG, VIEW_CATEGORY, SEARCH_PRODUCT, VIEW_PRODUCT, ADD_TO_CART, VIEW_CART, MODIFY_CART, CHECKOUT, APPLY_COUPON, ORDER_STATUS, TRACK_SHIPPING, HELP, TALK_TO_HUMAN, UNKNOWN. Store parsed response in conversation context for multi-turn handling. Add filter 'wch_parse_response' for custom parsing extensions. Acceptance criteria: All WhatsApp message types parsed correctly, intents detected accurately for common phrases, unknown intents gracefully handled, parser is extensible via filters."
M02-01,"WooCommerce Product Sync Service","Create bidirectional product synchronization between WooCommerce and WhatsApp Catalog. Create class WCH_Product_Sync_Service. Method sync_product_to_whatsapp($product_id): Get WC_Product, validate (must be published, in-stock if setting enabled, in allowed product list). Map WC product to WhatsApp catalog format: retailer_id = product_id, name (max 200 chars), description (max 9999 chars), price (cents integer), currency, url (product permalink), image_url (main image), availability (in_stock/out_of_stock), category, brand. Handle variable products: sync each variation as separate item with parent reference. Call WhatsApp Catalog API POST /{catalog_id}/products. Store wa_catalog_item_id in product meta '_wch_catalog_id'. Method sync_all_products(): Get products based on settings (all or specific IDs), batch process 50 at a time using WCH_Queue. Method delete_from_catalog($product_id): Remove from WhatsApp catalog if exists. Method handle_product_update($product_id): Hook on 'woocommerce_update_product', check if product changed (title, price, stock, image), queue sync if changed. Method handle_product_delete($product_id): Hook on 'before_delete_post' for product type, remove from catalog. Create sync status tracking: store last_synced timestamp and sync_status in product meta. Admin column in Products list showing sync status icon. Batch actions: 'Sync to WhatsApp', 'Remove from WhatsApp'. Acceptance criteria: Products sync automatically on change, deletions reflected in catalog, variable products handled correctly, sync status visible in admin, bulk sync works without timeout."
M02-02,"WooCommerce Order Sync Service","Create order synchronization from WhatsApp to WooCommerce. Create class WCH_Order_Sync_Service. Method create_order_from_cart($cart_data, $customer_phone): Validate cart items still in stock, create WC_Order programmatically with: billing/shipping from cart shipping_address, payment_method from cart, line items from cart items with current prices, apply coupon if present, calculate totals. Set order meta: '_wch_order' = true, '_wch_conversation_id', '_wch_customer_phone'. Set order status based on payment: 'pending' for COD, 'processing' for paid. Reduce stock via wc_reduce_stock_levels(). Return order_id or throw exception with reason. Method sync_order_status_to_whatsapp($order_id, $old_status, $new_status): Hook on 'woocommerce_order_status_changed'. Map WC status to notification template: pending->processing = 'order_confirmed', processing->completed = 'order_completed', processing->shipped = 'shipping_update' (if tracking), any->cancelled/refunded = 'order_cancelled'. Queue notification via WCH_Queue. Method add_tracking_info($order_id, $tracking_number, $carrier): Store in order meta, trigger shipping_update notification. Create order notes integration: add WCH conversation link to order notes, show WhatsApp icon in orders list. Admin order page metabox: show conversation history link, customer WhatsApp profile, quick reply button opening modal. Filter orders by WhatsApp source using custom query var. Acceptance criteria: Orders created with all data correctly mapped, stock reduced atomically, status changes trigger appropriate notifications, admin can filter and manage WhatsApp orders."
M02-03,"Inventory Real-time Sync Handler","Create real-time inventory synchronization. Create class WCH_Inventory_Sync_Handler. Hook on 'woocommerce_product_set_stock' and 'woocommerce_variation_set_stock'. Method handle_stock_change($product): Get new stock quantity. If stock <= 0 and was >0: update WhatsApp catalog availability to 'out_of_stock'. If stock >0 and was <=0: update to 'in_stock'. If low stock threshold reached (WC setting): optionally notify subscribed customers via broadcast. Use debouncing: store pending sync in transient for 5 seconds before executing (prevents multiple API calls during bulk updates). Method sync_stock_from_woocommerce($product_id): One-way push current stock status to WhatsApp. Method handle_order_stock_reduction($order_id): After order placed, check all ordered products' stock and update catalog if any went out of stock. Create stock discrepancy detector: daily cron comparing WC stock with WhatsApp catalog, log discrepancies, optionally auto-fix. Admin settings: enable_realtime_sync (bool), low_stock_threshold (int), notify_low_stock (bool), auto_fix_discrepancies (bool). Dashboard widget showing: products in sync, out of sync count, last sync time, sync errors. Acceptance criteria: Stock changes reflected in catalog within 10 seconds, out of stock products unavailable in WhatsApp, bulk updates debounced, discrepancies detected and logged."
M02-04,"Customer Data Mapper & Profile Service","Create customer profile management linking WhatsApp users to WooCommerce customers. Create class WCH_Customer_Service. Method get_or_create_profile($phone): Normalize phone to E.164, check wch_customer_profiles table, create if not exists, return WCH_Customer_Profile object. Method link_to_wc_customer($phone, $wc_customer_id): Associate WhatsApp profile with WooCommerce customer, merge order history. Method find_wc_customer_by_phone($phone): Search WC customers by billing_phone meta (with format variations +1xxx, 1xxx, xxx), return customer_id or null. WCH_Customer_Profile class properties: phone, wc_customer_id (nullable), name, saved_addresses (array), order_history (from WC if linked), preferences (language, currency), opt_in_marketing, lifetime_value (calculated), last_order_date, total_orders. Method save_address($phone, $address_data, $is_default): Validate address fields, store in saved_addresses JSON, mark as default if specified. Method get_default_address($phone): Return default saved address or null. Method update_preferences($phone, $preferences): Merge and save preference updates. Method get_order_history($phone): If linked to WC customer, fetch orders, else fetch orders with matching billing_phone. Method calculate_customer_stats($phone): Return total_orders, total_spent, average_order_value, days_since_last_order. Privacy methods: export_customer_data($phone) for GDPR export, delete_customer_data($phone) for GDPR erasure - anonymize conversations, delete profile. Acceptance criteria: Profiles persist across conversations, WC linking works with phone variations, addresses save and retrieve correctly, GDPR methods complete, customer stats accurate."
M03-01,"Conversation State Machine","Create finite state machine for managing conversation flows. Create class WCH_Conversation_FSM. States enum: IDLE, BROWSING, VIEWING_PRODUCT, CART_MANAGEMENT, CHECKOUT_ADDRESS, CHECKOUT_PAYMENT, CHECKOUT_CONFIRM, AWAITING_HUMAN, COMPLETED. Events enum: START, SELECT_CATEGORY, SEARCH, VIEW_PRODUCT, ADD_TO_CART, VIEW_CART, MODIFY_CART, START_CHECKOUT, ENTER_ADDRESS, SELECT_PAYMENT, CONFIRM_ORDER, REQUEST_HUMAN, AGENT_TAKEOVER, TIMEOUT, RESET. Define transitions array: {from_state, event, to_state, guard_condition, action}. Example transitions: (IDLE, START, BROWSING, null, show_main_menu), (BROWSING, VIEW_PRODUCT, VIEWING_PRODUCT, product_exists, show_product_details), (VIEWING_PRODUCT, ADD_TO_CART, CART_MANAGEMENT, has_stock, add_item_and_show_cart), (CART_MANAGEMENT, START_CHECKOUT, CHECKOUT_ADDRESS, cart_not_empty, request_address). Method transition($conversation, $event, $payload): Get current state, find valid transition, check guard condition, execute action, update state, persist to database, log transition. Method get_available_events($conversation): Return valid events from current state. Create WCH_Conversation_Context class storing: current_state, state_data (temporary data like selected_product_id), conversation_history (last 10 exchanges), started_at, last_activity_at. Timeout handling: After 30 min inactivity, transition to IDLE with cart preserved. Save context on every state change. Add filter 'wch_fsm_transitions' to allow adding custom states/transitions. Acceptance criteria: State transitions enforce valid flows, invalid events rejected gracefully, context persists correctly, timeouts handled, extensible via filters."
M03-02,"Conversation Context Manager","Create context management for multi-turn conversations. Create class WCH_Context_Manager. Method get_context($conversation_id): Load from wch_conversations.context JSON column, return WCH_Conversation_Context object or new instance if null. Method save_context($conversation_id, $context): Serialize and save to database, update last_activity timestamp. Method clear_context($conversation_id): Reset to initial state, preserve customer linkage. WCH_Conversation_Context properties and methods: state (current FSM state), state_data (associative array), history (array of last 10 message pairs), slots (extracted entity values like product_name, quantity, address), customer_phone, started_at, expires_at. Slot management: set_slot($name, $value), get_slot($name, $default), has_slot($name), clear_slot($name), get_all_slots(). History management: add_exchange($user_message, $bot_response), get_history(), get_last_exchange(). Method build_ai_context(): Return formatted string for AI prompts including: business name, current state, filled slots, recent history, available actions. Implement context expiration: If last_activity older than 24 hours, archive conversation and start fresh. Create method merge_contexts($old_context, $new_data): Intelligently merge returning customer context with new session. Store frequently accessed contexts in object cache for performance. Acceptance criteria: Context persists across messages, slots retain values through conversation, history properly truncated, AI context well-formatted, expired contexts handled."
M03-03,"Flow Action Handlers","Create action handlers executed during state transitions. Create abstract class WCH_Flow_Action with method execute($conversation, $context, $payload): WCH_Action_Result. WCH_Action_Result contains: success (bool), response_messages (array of WCH_Message_Builder), next_state (optional override), updated_context. Implement concrete actions: WCH_Action_ShowMainMenu: Send interactive list with categories: Shop by Category, Search Products, View Cart, Track Order, Talk to Support. Include personalized greeting if returning customer. WCH_Action_ShowCategory: Accept category_id in payload, fetch products in category (paginated 10), send product list message with images, prices, quick-add buttons. WCH_Action_ShowProduct: Accept product_id in payload, send product card with full description, images (carousel if multiple), price, stock status, variant selector if applicable, Add to Cart button. WCH_Action_AddToCart: Accept product_id, variant_id, quantity in payload, validate stock, add to wch_carts table, send confirmation with cart summary and Continue Shopping / Checkout buttons. WCH_Action_ShowCart: Fetch customer cart, send itemized list with quantities, item totals, subtotal, modify/remove buttons per item, Checkout button. WCH_Action_RequestAddress: If saved addresses exist, send list to select or enter new. Otherwise send text prompt for address entry. WCH_Action_ProcessPayment: Based on payment method, either mark ready (COD), send payment link (card), or send UPI intent (UPI). WCH_Action_ConfirmOrder: Show final summary, create WC order, send order confirmation with order number and status. Actions must be idempotent - safe to retry on failure. Acceptance criteria: Each action sends appropriate message type, cart operations atomic, payment methods handled, orders created correctly, all actions have error handling."
M03-04,"Natural Language Intent Classifier","Create NLP-based intent classification for free-text messages. Create class WCH_Intent_Classifier. Method classify($text, $context): Return WCH_Intent object with intent, confidence (0-1), entities array. WCH_Intent properties: intent_name (string from enum), confidence (float), entities (array of {type, value, position}). Implement rule-based classifier as primary: Define patterns for each intent using regex and keyword matching. GREETING: /^(hi|hello|hey|good\s*(morning|afternoon|evening))/i. BROWSE: /(show|browse|see|view).*(products?|catalog|items?|collection)/i. SEARCH: /(search|find|looking for|want|need)\s+(.+)/i - capture search term. VIEW_CART: /(my )?(cart|basket|bag)/i. CHECKOUT: /(checkout|buy|purchase|pay|order)/i. ORDER_STATUS: /(order|track|where).*(status|order|package|delivery)/i - extract order number if present. CANCEL: /(cancel|remove|delete)/i. HELP: /(help|support|assist|human|agent|person)/i. Extract entities: PRODUCT_NAME from search queries, QUANTITY (numbers before/after quantity words), ORDER_NUMBER (#\d{4,} pattern), PHONE, EMAIL, ADDRESS (heuristic). Optional AI-enhanced classification for ambiguous cases: If rule-based confidence < 0.7 and AI enabled, call OpenAI with context to classify. Cache classifications with text hash key for 1 hour. Add filter 'wch_custom_intents' to register business-specific intents. Log all classifications for training data collection. Acceptance criteria: Common intents classified >90% accuracy, entities extracted correctly, fallback to AI works, classification <100ms for rules, custom intents supportable."
M03-05,"AI Conversation Assistant Integration","Create OpenAI integration for enhanced conversation handling. Create class WCH_AI_Assistant. Constructor accepts config: api_key, model, temperature, max_tokens, system_prompt. Method generate_response($user_message, $context): Build prompt, call API, parse response, return text and any extracted actions. Build system prompt dynamically including: Business identity and tone guidelines, available products summary (top categories, current promotions), current conversation state and context, customer profile if known, specific instructions based on state (e.g., 'Help customer choose a product' in BROWSING state). Use function calling for structured outputs. Define functions: suggest_products(query, limit), get_product_details(product_id), add_to_cart(product_id, quantity), apply_coupon(code), escalate_to_human(reason). Method process_function_call($function_name, $arguments): Execute the corresponding WCH action and return result to AI for final response. Rate limiting: Max 10 AI calls per conversation per hour, fallback to rule-based responses if exceeded. Cost tracking: Log token usage per conversation, calculate estimated cost, set monthly budget cap in settings with alerts at 80% and 100%. Error handling: Timeout after 15 seconds, retry once on 5xx errors, graceful degradation message on failure. Content filtering: Validate AI responses don't contain inappropriate content before sending. Acceptance criteria: AI responses contextually appropriate, function calls execute correctly, rate limits enforced, costs tracked, failures handled gracefully."
M04-01,"Product Catalog Browser Interface","Create interactive product browsing experience in WhatsApp. Create class WCH_Catalog_Browser. Method show_main_menu($conversation): Send interactive list with sections: Categories (dynamic from WC), Featured (on-sale or featured products), Search, Quick Reorder (if returning customer). Method show_category($conversation, $category_id, $page): Fetch products in category with pagination (10 per page), send product list message with: Header showing category name, Body with product count, Sections grouped by subcategory or alphabetically, Each row: product name (50 char max), price, short description (72 char max). Include navigation buttons: Previous Page (if page > 1), Next Page (if more), Back to Categories. Method show_product_detail($conversation, $product_id): Fetch full product data, send sequence: Image message with main product photo, Text message with: name, full description, price (sale price highlighted), availability, Text message with variants if variable product (color, size options as numbered list), Interactive buttons: Add to Cart, View More Images (if multiple), Back to Browsing. For variable products, method show_variant_selector($conversation, $product_id, $attribute): Send list message with available options for that attribute. Method search_products($conversation, $query): Search WC products by name and SKU, return top 10 matches as product list, suggest categories if no matches. Method show_featured($conversation): Query products with _featured meta or on_sale, display as curated list. Implement product image optimization: Generate WhatsApp-optimized thumbnails (500x500), cache URLs. Acceptance criteria: Categories load dynamically from WC, products display correctly, pagination works, variants selectable, search returns relevant results, images optimized."
M04-02,"Shopping Cart Manager","Create cart management functionality. Create class WCH_Cart_Manager. Cart stored in wch_carts table, keyed by customer_phone. Cart item structure: {product_id, variation_id (nullable), quantity, price_at_add, product_name, variant_attributes}. Method get_cart($phone): Return cart array or empty cart with expiry set to 72 hours from now. Method add_item($phone, $product_id, $variation_id, $quantity): Validate product exists and in stock, check quantity against stock, if item already in cart then increment quantity else add new item, update cart expiry, return updated cart. Throw WCH_Cart_Exception if validation fails with specific reason. Method update_quantity($phone, $item_index, $new_quantity): Validate stock, update quantity, recalculate totals, return updated cart. Remove item if quantity is 0. Method remove_item($phone, $item_index): Remove item from cart, return updated cart. Method clear_cart($phone): Empty cart items but retain customer association. Method apply_coupon($phone, $coupon_code): Validate WC coupon using WC_Coupon class, check restrictions (min total, product restrictions, usage limits), store coupon_code in cart, return discount amount or throw exception with reason. Method remove_coupon($phone): Clear coupon from cart. Method calculate_totals($cart): Return {subtotal, discount, tax, shipping_estimate, total} using WC tax and shipping calculation. Method get_cart_summary_message($phone): Build formatted text summary: itemized list with quantities and line totals, subtotal, discount if coupon applied, estimated shipping, total. Method check_cart_validity($phone): Verify all items still exist, in stock, prices unchanged. Mark items with issues and return validation result. Abandoned cart detection: Flag carts not converted within configured hours. Acceptance criteria: Cart CRUD operations work atomically, coupons validate correctly, totals match WC calculations, expired carts cleaned up, abandoned carts detected."
M04-03,"Checkout Flow Controller","Create multi-step checkout process within WhatsApp. Create class WCH_Checkout_Controller. Checkout steps: ADDRESS, SHIPPING_METHOD, PAYMENT_METHOD, REVIEW, CONFIRM. Method start_checkout($conversation): Validate cart not empty, check_cart_validity(), transition to CHECKOUT_ADDRESS state, call request_address(). Method request_address($conversation): If customer has saved addresses, send list message to select existing or enter new. Otherwise prompt for address entry with format instructions. Method process_address_input($conversation, $input): If list selection, load saved address. If text, parse address using WCH_Address_Parser (extract name, street, city, state, postal, country). Validate address completeness, store in checkout context, request shipping method. Method show_shipping_methods($conversation): Calculate available WC shipping methods for address and cart, send list with shipping options showing name and cost, store selection in context. Method show_payment_methods($conversation): Based on settings and region, send list of enabled payment methods: COD, UPI (India), PIX (Brazil), Card (Stripe/PayPal link), WhatsApp Pay (if available). Each option shows any additional fees. Method process_payment_selection($conversation, $method): Store selection, calculate final totals including payment fees, show order review. Method show_order_review($conversation): Send detailed summary message: items, shipping address, shipping method + cost, payment method + any fees, total. Include Edit buttons for each section and Confirm Order button. Method confirm_order($conversation): Final stock check, create WC order via WCH_Order_Sync_Service, process payment if applicable, clear cart, send confirmation with order number. Handle errors: Out of stock during checkout sends notification and returns to cart. Payment failure shows retry option. Acceptance criteria: Checkout progresses through all steps, address parsing works, shipping calculated correctly, payment methods work, order created successfully, edge cases handled."
M04-04,"Payment Gateway Integrations","Create payment processing integrations for supported methods. Create interface WCH_Payment_Gateway: get_id(), get_title(), is_available($country), process_payment($order_id, $conversation), handle_callback($data), get_payment_status($transaction_id). Implement WCH_Payment_COD: Simple confirmation, adds COD fee to order if configured, order status stays 'pending', completes on delivery. Implement WCH_Payment_Stripe: Generate Stripe Checkout session with order items, send payment link message, handle webhook for payment_intent.succeeded to update order, support card and local payment methods. Implement WCH_Payment_Razorpay (India): Generate Razorpay payment link, send to customer, handle webhook for payment.captured, support UPI, cards, netbanking. Implement WCH_Payment_WhatsAppPay: Use WhatsApp Payments API for in-app payment (where available), handle payment response in webhook. Implement WCH_Payment_PIX (Brazil): Generate PIX QR code via PagSeguro/Mercado Pago, send as image, handle confirmation webhook. Create WCH_Payment_Manager: register_gateway($gateway), get_available_gateways($country), get_gateway($id), process_order_payment($order_id, $gateway_id, $conversation). Payment failure handling: Log failure reason, send friendly error message, offer retry or alternate payment method. Refund support: Trigger original gateway refund when WC refund processed. Store payment transaction ID in order meta for reference. Acceptance criteria: All gateways process payments correctly, webhooks update order status, refunds work, failures handled gracefully, transactions logged."
M05-01,"WordPress Admin Settings Page","Create comprehensive admin settings interface. Register admin menu under WooCommerce using add_submenu_page on admin_menu hook: 'WhatsApp Commerce Hub' with capability 'manage_woocommerce'. Create class WCH_Admin_Settings. Render settings page with tabs: Connection, Catalog, Checkout, Notifications, AI, Advanced. CONNECTION TAB: WhatsApp Phone Number ID input, Business Account ID input, Access Token password field (masked), Verify Token generated field with regenerate button, Webhook URL display (read-only with copy button), Test Connection button with AJAX handler returning connection status and business profile. CATALOG TAB: Enable Sync toggle, Product Selection (All / Specific categories / Specific products) with WC product search, Include Out of Stock toggle, Sync Now button with progress indicator, Last Sync timestamp display. CHECKOUT TAB: Enabled Payment Methods multi-select, COD settings (enable, extra charge amount), Order Limits (min, max amounts), Phone Verification toggle. NOTIFICATIONS TAB: Toggle for each notification type (order confirmation, status updates, shipping, abandoned cart), Abandoned Cart Delay hours input, Test notification button per type. AI TAB: Enable AI toggle, OpenAI API Key password field, Model select (gpt-4, gpt-3.5-turbo), Temperature slider, Custom System Prompt textarea. ADVANCED TAB: Debug Mode toggle, Log Retention days, Clear Logs button, Export Settings button, Import Settings file upload, Reset to Defaults button. Use Settings API with sanitization callbacks. Save with AJAX for instant feedback. Add contextual help tab with documentation links. Acceptance criteria: All settings save and load correctly, sensitive fields masked, test buttons work, settings validate on save, UI responsive and accessible."
M05-02,"Admin Dashboard & Analytics Widget","Create analytics dashboard for WhatsApp commerce performance. Register dashboard widget with wp_add_dashboard_widget and WooCommerce Analytics integration. Create class WCH_Analytics_Dashboard. Main metrics cards (real-time from database): Total WhatsApp Orders (today/week/month), WhatsApp Revenue (today/week/month), Active Conversations (currently open), Conversion Rate (orders/conversations). Charts using Chart.js or WC Analytics components: Orders over time (line chart, last 30 days), Revenue by day (bar chart), Top Products via WhatsApp (horizontal bar), Conversation volume heatmap by hour/day. Detailed metrics section: Average Order Value (WhatsApp vs Website comparison), Cart Abandonment Rate with trend, Bot Containment Rate (auto-resolved vs escalated), Average Response Time, Message Volume (inbound/outbound). Customer insights: New vs Returning customer split, Geographic distribution (from phone country codes), Top customers by order value. Funnel visualization: Conversations Started -> Product Viewed -> Added to Cart -> Checkout Started -> Order Completed. Filters: Date range picker, Compare to previous period toggle. Export functionality: CSV export of detailed data, PDF report generation. Create WP REST endpoints for AJAX data loading: /analytics/summary, /analytics/orders, /analytics/conversations, /analytics/funnel. Cache expensive queries in transients with 15-minute expiry. Dashboard refreshes every 5 minutes via AJAX. Acceptance criteria: Dashboard loads performantly (<2s), charts render correctly, filters work, data accurate against raw tables, export produces valid files."
M05-03,"Conversation Inbox Interface","Create admin interface for viewing and managing conversations. Add submenu page 'Inbox' under WhatsApp Commerce Hub. Create class WCH_Admin_Inbox using React for frontend (build with wp-scripts). Inbox layout: Left sidebar with conversation list, Main area with selected conversation, Right sidebar with customer details. Conversation list features: Search by phone number or name, Filter by status (active, pending, closed), Filter by assigned agent, Sort by last message time, Unread indicator badge, Preview of last message (truncated). List item shows: Customer name or phone, Last message preview, Timestamp, Status badge, Assigned agent avatar. Conversation view features: Full message history with sender indicators, Message timestamps, Message status icons (sent/delivered/read), Media attachments rendered inline, System messages (state transitions, agent assignments) styled differently. Quick actions toolbar: Assign to agent dropdown, Mark as closed button, View customer profile button, View linked order button (if exists). Reply composer at bottom: Text input with emoji picker, Attachment button for images/documents, Send button, Template selector dropdown for quick responses, AI Suggest button generating contextual reply. Customer sidebar: Profile photo placeholder, Phone number with click-to-copy, Linked WC customer link, Order history list, Total spent, Saved addresses, Notes field for agent comments. Real-time updates using polling (every 10 seconds) or WebSocket if available. Bulk actions on list: Assign selected, Close selected, Export selected. Acceptance criteria: Inbox loads conversations correctly, messages display in order, replies send successfully, real-time updates work, UI is responsive."
M05-04,"Product Sync Admin Interface","Create admin interface for managing product catalog sync. Add submenu page 'Catalog Sync' under WhatsApp Commerce Hub. Create class WCH_Admin_Catalog_Sync. Main sections: Sync Status Overview, Product Selection, Sync History. SYNC STATUS OVERVIEW: Cards showing: Total Products Synced count, Last Full Sync timestamp, Sync Errors count (clickable for details), WhatsApp Catalog ID with link to Meta Business Suite. Action buttons: Sync All Now, Sync Selected, Refresh Status. PRODUCT SELECTION: WooCommerce-style table listing products with columns: Checkbox, Thumbnail, Name, SKU, Price, Stock Status, Sync Status (synced/pending/error/not selected), Last Synced, Actions. Sync Status badges: Green 'Synced' with checkmark, Yellow 'Pending' with clock, Red 'Error' with hover showing error message, Gray 'Not Selected' for excluded products. Bulk actions: Add to WhatsApp Catalog, Remove from Catalog, Retry Failed. Filters: Category dropdown, Stock status, Sync status, Search box. Row action: View on WhatsApp (link to catalog), Sync Now, Remove, View Error Log. SYNC HISTORY: Table of recent sync operations showing: Timestamp, Products Affected count, Status (success/partial/failed), Duration, Error count with expandable details, Triggered By (auto/manual/hook). Pagination for history. Settings panel: Sync Mode (manual only, on product change, scheduled), Schedule frequency if scheduled (hourly, twice daily, daily), Categories to Include multi-select, Categories to Exclude multi-select. Dry Run button: Shows what would be synced without executing. Progress modal during bulk sync showing: Products processed / total, Current product name, Errors encountered, Estimated time remaining, Cancel button. Acceptance criteria: Products display with correct sync status, bulk operations work, history tracks all syncs, settings persist, progress shows during long operations."
M05-05,"Broadcast Campaign Manager","Create admin interface for promotional broadcast campaigns. Add submenu page 'Broadcasts' under WhatsApp Commerce Hub. Create class WCH_Admin_Broadcasts. Campaign list view: Table with columns (Name, Template, Audience Size, Status, Sent/Delivered/Read stats, Scheduled/Sent date, Actions). Status badges: Draft, Scheduled, Sending, Completed, Failed. Actions: Edit (draft only), Duplicate, View Report, Delete. Create Campaign wizard (multi-step): STEP 1 - Template Selection: List approved WhatsApp templates, Preview selected template with variable placeholders highlighted, Warning if template not approved. STEP 2 - Audience Selection: Audience builder with criteria: All opted-in customers, Ordered in last X days, Category purchasers, Cart abandoners, Custom segment from WC customer filters. Show estimated audience count updating in real-time as criteria added. Exclusion rules: Exclude recent broadcast recipients (X days), Exclude customers who opted out. STEP 3 - Personalization: Map template variables to customer data or static text, Variable {{1}} -> Customer Name / Static text, Variable {{2}} -> Product Name / Coupon Code / etc, Preview with sample customer data. STEP 4 - Schedule: Send Now or Schedule for datetime, Timezone selection, Optimal Send Time suggestion based on historical open rates. STEP 5 - Review: Full summary, Estimated cost (based on Meta pricing), Send Test button (to admin phone), Confirm and Schedule button. Campaign report view: Delivery funnel: Sent -> Delivered -> Read with percentages, Engagement: Link clicks if tracked, Revenue attributed to campaign, Errors breakdown with reasons, Export recipient list with status. Duplicate campaign: Pre-fill wizard with previous settings. Acceptance criteria: Campaigns create and schedule correctly, templates render with variables, audience counts accurate, broadcasts send via queue, reports show accurate stats."
M06-01,"Order Notification Templates System","Create templated notification system for order lifecycle events. Create class WCH_Order_Notifications. Register WooCommerce hooks: 'woocommerce_order_status_changed' for status notifications, 'woocommerce_new_order' for confirmation (WhatsApp orders only), 'woocommerce_shipment_tracking_info_added' for shipping updates (if Shipment Tracking plugin). Method send_order_confirmation($order_id): Get order, extract customer phone from billing or WCH meta, build template variables: {customer_name, order_number, order_total, item_count, estimated_delivery}, send using approved WhatsApp template 'order_confirmation'. Method send_status_update($order_id, $new_status): Map WC status to customer-friendly text, build variables: {order_number, status_text, status_emoji, action_needed}, select template based on status (processing, shipped, completed, cancelled, refunded), send notification. Method send_shipping_update($order_id, $tracking_number, $carrier): Build variables: {order_number, carrier_name, tracking_number, tracking_url}, send 'shipping_update' template with tracking link button. Method send_delivery_confirmation($order_id): Send when status becomes 'completed', include review request link if WC reviews enabled. Create notification preferences: Per-customer opt-out stored in WCH profile, Global toggles in settings per notification type, Quiet hours (don't send between 10pm-8am customer local time). Notification queue: Don't send immediately, queue for 30 seconds to allow order data to settle, batch multiple status changes into single notification. Retry logic: 3 attempts with 5-minute intervals if send fails. Log all notifications sent in wch_notification_log table. Admin order page metabox: Show notification history for order with sent/delivered/read status. Acceptance criteria: All order events trigger correct notifications, templates render correctly, quiet hours respected, retries work, notification history visible."
M06-02,"Abandoned Cart Recovery System","Create automated abandoned cart recovery via WhatsApp. Create class WCH_Abandoned_Cart_Recovery. Define abandoned cart: Cart with items, no order created, last activity older than threshold (configurable, default 4 hours). Scheduled task via Action Scheduler: Run every 30 minutes, query wch_carts where updated_at < (now - threshold) AND reminder_sent = false AND items not empty. Recovery sequence (configurable): First reminder at 4 hours, Second reminder at 24 hours (if first not converted), Final reminder at 48 hours with discount offer (optional). Method send_recovery_message($cart, $sequence_number): Build template variables: {customer_name, item_count, cart_total, top_item_name, top_item_image}, add personalized discount code if sequence 3 and setting enabled (generate unique single-use WC coupon), include View Cart deep link, send appropriate template based on sequence. Track in cart meta: reminder_1_sent_at, reminder_2_sent_at, reminder_3_sent_at, recovery_coupon_code. Conversion tracking: When order placed, check if cart had recovery messages sent, mark as recovered, attribute revenue to recovery campaign. Stop sequence immediately when: Customer replies (any message), Customer completes purchase, Customer opts out, Cart is modified (reset sequence). Admin dashboard widget: Abandoned carts (last 7 days), Recovery messages sent, Carts recovered, Recovery rate percentage, Revenue recovered. Settings: Enable/disable recovery, Delays for each sequence, Enable discount on final reminder, Discount type (percentage/fixed) and amount, Recovery message templates selection. A/B testing: Optionally split audience for different message variants, track performance by variant. Acceptance criteria: Abandoned carts detected correctly, sequences send at right times, conversions attributed, stops on customer action, stats accurate."
M06-03,"Customer Re-engagement Campaigns","Create automated re-engagement for inactive customers. Create class WCH_Reengagement_Service. Define inactive customer: Has made purchase, no orders in X days (configurable, default 60 days), opted-in to marketing. Scheduled task: Run daily, identify newly inactive customers (crossed threshold today). Re-engagement triggers: Time-based inactivity, Browse abandonment (viewed products but didn't add to cart - requires tracking), Wishlist reminders (if wishlist plugin integrated), Back-in-stock notifications, Price drop alerts on viewed products. Method identify_inactive_customers(): Query WC orders joined with WCH profiles, find customers with last_order_date < (now - threshold), exclude recently messaged (within 7 days), return list with customer data. Method send_reengagement($customer, $campaign_type): Select appropriate template, personalize with: last purchased product, recommended products based on history, exclusive offer if enabled, send via WCH_WhatsApp_API_Client. Campaign types and templates: 'we_miss_you' - generic reengagement, 'new_arrivals' - products added since last visit, 'back_in_stock' - previously viewed OOS items now available, 'price_drop' - viewed products now on sale, 'loyalty_reward' - discount based on lifetime value. Back-in-stock notification system: Track product views in wch_product_views table (customer_phone, product_id, viewed_at), when product stock changes from 0 to >0, query interested customers, queue notifications. Price drop tracking: Store viewed product prices, compare on price changes, notify if price dropped >10%. Frequency capping: Max 1 reengagement message per customer per 7 days, max 4 per month. Analytics: Track sent, opened, converted for each campaign type. Acceptance criteria: Inactive customers identified correctly, appropriate campaigns sent, frequency caps enforced, back-in-stock and price drop triggers work, conversions tracked."
M07-01,"PHPUnit Test Suite Setup","Create comprehensive test infrastructure for the plugin. Create directory /tests with structure: /tests/bootstrap.php, /tests/Unit, /tests/Integration, /tests/fixtures. Configure PHPUnit with phpunit.xml.dist: Test suites for Unit and Integration, Bootstrap file path, Coverage report configuration (HTML and Clover), Strict mode enabled. Bootstrap.php setup: Load WordPress test library from WP_TESTS_DIR, Load WooCommerce testing framework, Activate plugin programmatically, Set up test database tables. Create abstract class WCH_Unit_Test_Case extending WP_UnitTestCase: setUp() initializing common mocks, tearDown() cleanup, Helper method create_test_product() returning WC_Product, Helper method create_test_order() returning WC_Order, Helper method create_test_conversation() returning conversation ID, Mock factory for WCH_WhatsApp_API_Client. Create WCH_Integration_Test_Case extending WCH_Unit_Test_Case: setUp() with real database tables, HTTP mocking using Brain Monkey or similar. Unit tests to create (/tests/Unit/): WCH_Settings_Test - get/set/encryption, WCH_Message_Builder_Test - all message types and validation, WCH_Intent_Classifier_Test - all intents with various phrasings, WCH_Cart_Manager_Test - all CRUD operations, WCH_Conversation_FSM_Test - all state transitions, WCH_Customer_Service_Test - profile operations. Integration tests (/tests/Integration/): WCH_Product_Sync_Test - sync to catalog API, WCH_Order_Sync_Test - order creation flow, WCH_Checkout_Test - full checkout flow, WCH_Webhook_Test - webhook processing, WCH_Payment_Test - payment gateway flows. Test fixtures: Sample webhook payloads, Sample product data, Sample conversation contexts. Acceptance criteria: Tests run via 'composer test', >80% code coverage target, CI/CD pipeline integration ready, mocks isolate external dependencies."
M07-02,"API Integration Tests & Mocks","Create mock server and integration tests for external APIs. Create class WCH_API_Mock_Server using Brain Monkey for HTTP mocking. Mock WhatsApp Cloud API responses: POST /messages success: {messages: [{id: 'wamid.xxx'}]}, POST /messages rate limit: 429 with Retry-After header, POST /messages invalid recipient: {error: {code: 131026, message: 'Recipient not valid'}}, GET /media success: binary data, POST /{catalog_id}/products success: {id: 'catalog_item_id'}. Mock WooCommerce REST API responses: GET /products success: product array, POST /orders success: order object, Webhook signature validation. Create test class WCH_WhatsApp_API_Integration_Test: test_send_text_message_success(), test_send_interactive_list_success(), test_send_template_message_success(), test_rate_limit_retry_succeeds(), test_invalid_recipient_throws_exception(), test_media_upload_success(), test_catalog_sync_success(). Create test class WCH_Webhook_Integration_Test: test_webhook_verification_valid_token(), test_webhook_verification_invalid_token(), test_webhook_signature_validation_success(), test_webhook_signature_validation_failure(), test_incoming_text_message_processed(), test_incoming_interactive_response_processed(), test_message_status_update_processed(), test_duplicate_message_ignored(). Create test class WCH_WooCommerce_Integration_Test: test_product_sync_creates_catalog_item(), test_order_creation_from_cart(), test_inventory_sync_on_stock_change(), test_order_status_triggers_notification(). Performance tests: test_message_handling_under_100ms(), test_bulk_product_sync_handles_1000_products(), test_concurrent_conversations_handled(). Create GitHub Actions workflow .github/workflows/tests.yml: Run on push and PR, Matrix testing PHP 8.1, 8.2, 8.3, WordPress latest and latest-1, WooCommerce latest and latest-1, Upload coverage reports. Acceptance criteria: All API interactions have mock tests, error scenarios covered, CI pipeline runs tests automatically, performance benchmarks established."
M07-03,"End-to-End Conversation Flow Tests","Create E2E tests for complete customer journeys. Create test class WCH_E2E_Conversation_Test extending WCH_Integration_Test_Case. Test scenarios to implement: test_complete_purchase_flow(): Simulate customer greeting -> browse category -> view product -> add to cart -> checkout with address -> select shipping -> select payment -> confirm order. Assert: All messages sent correctly, Cart created and modified properly, Order created in WooCommerce, Confirmation notification sent, Conversation state progresses correctly. test_cart_modification_flow(): Add product A -> Add product B -> Update quantity A -> Remove B -> Apply coupon -> View cart. Assert: Cart reflects all changes, Totals calculated correctly, Coupon validated and applied. test_returning_customer_flow(): Customer with saved address and order history, Quick reorder of previous product, Address selection from saved addresses. Assert: Customer recognized, History accessible, Checkout faster. test_abandoned_cart_recovery(): Add items -> Inactivity timeout -> Recovery message sent -> Customer returns -> Completes purchase. Assert: Cart preserved, Recovery attributed, Conversion tracked. test_human_handoff_flow(): Customer frustrated (detects sentiment or explicit request), Bot escalates to human, Human agent takes over, Conversation resolved. Assert: Escalation triggered, Agent notified, Context preserved. test_multi_language_flow(): Customer sends Hindi/Portuguese message, Bot responds in detected language, Flow completes in customer language. Assert: Language detected, Responses translated, Templates use correct language. test_error_recovery_flow(): Product goes out of stock during checkout, Payment fails, Network timeout during message send. Assert: Customer informed gracefully, Recovery options provided, No data corruption. Helper methods: simulate_webhook($message_data) - trigger webhook handler, assert_message_sent($expected_type, $expected_content), get_conversation_state($phone), advance_time($hours) for timeout testing. Acceptance criteria: All critical paths have E2E coverage, tests run in <5 minutes, failures indicate exact step that failed, tests are deterministic."
M07-04,"Developer Documentation & Inline Docs","Create comprehensive documentation for developers. Create /docs directory structure: /docs/README.md (overview), /docs/installation.md, /docs/configuration.md, /docs/api-reference.md, /docs/hooks-reference.md, /docs/extending.md, /docs/troubleshooting.md. README.md contents: Plugin description and features, Quick start guide, Requirements, Links to detailed docs. installation.md: System requirements detailed, Installation steps (manual and via composer), WhatsApp Business API setup guide with screenshots placeholders, WooCommerce configuration, First sync walkthrough. configuration.md: All settings explained with recommendations, Environment variables supported, wp-config.php constants (WCH_DEBUG, WCH_LOG_LEVEL, WCH_DISABLE_AI), Multi-site considerations. api-reference.md: REST API documentation: All endpoints with request/response examples, Authentication methods, Error codes and meanings, Rate limits. Use OpenAPI format for endpoints. hooks-reference.md: All actions and filters with: Hook name, Parameters, Example usage, When it fires. Categories: Conversation hooks, Order hooks, Sync hooks, Message hooks, Admin hooks. extending.md: Adding custom intents, Creating custom payment gateways, Adding custom flow states, Building add-on plugins, Customizing templates. troubleshooting.md: Common issues and solutions, Debug mode usage, Log interpretation, WhatsApp API error codes, Support contact. Add PHPDoc blocks to all classes and public methods: @description, @since version, @param with types, @return with type, @throws with exception types, @example where helpful. Generate API documentation using phpDocumentor or similar. Create CHANGELOG.md following Keep a Changelog format. Create CONTRIBUTING.md with: Code style (WordPress coding standards), Pull request process, Testing requirements, Branch naming convention. Acceptance criteria: All public APIs documented, hooks discoverable, installation guide complete, PHPDoc coverage >90%, documentation builds without errors."
M07-05,"Code Quality & WordPress Standards","Implement code quality tools and WordPress coding standards compliance. Create composer.json with: PHP requirement ^8.1, Dev dependencies: phpunit, phpcs, phpcbf, phpstan, brain/monkey, Scripts: test, lint, lint:fix, analyze. Configure PHPCS with phpcs.xml.dist: Ruleset: WordPress-Extra and WordPress-Docs, Exclude: vendor, node_modules, tests, Custom rules: line length 120, Required file headers. Run PHPCS and fix all violations. Create custom sniffs if needed for WCH-specific patterns. Configure PHPStan with phpstan.neon: Level 6 (strict), WordPress extension, WooCommerce stubs, Baseline file for gradual adoption. Run PHPStan and fix all errors or add to baseline with justification. Create .editorconfig: indent_style = tab (WordPress standard), indent_size = 4, end_of_line = lf, charset = utf-8. Create pre-commit hook via Husky or similar: Run PHPCS on changed files, Run PHPStan on changed files, Run affected unit tests, Block commit on failures. Create GitHub Actions workflow .github/workflows/quality.yml: Run PHPCS, Run PHPStan, Check for security advisories, Upload reports as artifacts. Implement security best practices: All database queries use $wpdb->prepare(), All output escaped with esc_html/esc_attr/esc_url, Nonce verification on all form submissions, Capability checks on all admin actions, Sanitize all input with sanitize_text_field/absint/etc. Create security.md documenting: Security measures implemented, Responsible disclosure process, Known security considerations. Acceptance criteria: Zero PHPCS errors, Zero PHPStan errors at level 6, Pre-commit hooks prevent violations, CI blocks PRs with violations, Security review checklist passed."
M07-06,"Plugin Readme & WordPress.org Submission Prep","Prepare plugin for WordPress.org repository submission. Create readme.txt following WordPress.org standards: === WhatsApp Commerce Hub === Contributors: (username), Tags: whatsapp, woocommerce, ecommerce, chat commerce, conversational commerce, Requires at least: 6.0, Tested up to: 6.4, Requires PHP: 8.1, Stable tag: 1.0.0, License: GPLv2 or later, License URI: https://www.gnu.org/licenses/gpl-2.0.html. Short description (150 chars max). Long description with: Feature list, Use cases, Requirements, Setup overview, Links to documentation. Installation section: Step by step instructions, Configuration steps, Common issues. FAQ section: At least 10 questions covering common concerns, WhatsApp Business API costs, Data privacy, WooCommerce compatibility. Screenshots section: Describe each screenshot (create placeholder list), Dashboard, Settings, Inbox, Conversation flow. Changelog section: Version 1.0.0 with feature list. Upgrade Notice section. Create /assets directory for WordPress.org: banner-772x250.png, banner-1544x500.png, icon-128x128.png, icon-256x256.png, screenshot-1.png through screenshot-N.png. Internationalization: Ensure all strings use __() or _e() with 'whatsapp-commerce-hub' text domain, Create POT file using wp-cli: wp i18n make-pot, Add translator comments for complex strings. Create release checklist document: Version number updated everywhere, Changelog updated, Readme tested with validator, Assets created, POT file regenerated, All tests passing, Security review completed, Performance tested. Create GitHub release workflow: Tag triggers release, Builds production zip (excluding dev files), Attaches to GitHub release, Optionally deploys to WordPress.org SVN. Acceptance criteria: Readme passes WordPress.org validator, All strings translatable, Assets meet dimension requirements, Release process automated, Plugin passes WordPress.org review guidelines."