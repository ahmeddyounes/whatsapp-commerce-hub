# M03-03 â€” Flow Action Handlers

Create action handlers executed during state transitions. Create abstract class WCH_Flow_Action with method execute($conversation, $context, $payload): WCH_Action_Result. WCH_Action_Result contains: success (bool), response_messages (array of WCH_Message_Builder), next_state (optional override), updated_context. Implement concrete actions: WCH_Action_ShowMainMenu: Send interactive list with categories: Shop by Category, Search Products, View Cart, Track Order, Talk to Support. Include personalized greeting if returning customer. WCH_Action_ShowCategory: Accept category_id in payload, fetch products in category (paginated 10), send product list message with images, prices, quick-add buttons. WCH_Action_ShowProduct: Accept product_id in payload, send product card with full description, images (carousel if multiple), price, stock status, variant selector if applicable, Add to Cart button. WCH_Action_AddToCart: Accept product_id, variant_id, quantity in payload, validate stock, add to wch_carts table, send confirmation with cart summary and Continue Shopping / Checkout buttons. WCH_Action_ShowCart: Fetch customer cart, send itemized list with quantities, item totals, subtotal, modify/remove buttons per item, Checkout button. WCH_Action_RequestAddress: If saved addresses exist, send list to select or enter new. Otherwise send text prompt for address entry. WCH_Action_ProcessPayment: Based on payment method, either mark ready (COD), send payment link (card), or send UPI intent (UPI). WCH_Action_ConfirmOrder: Show final summary, create WC order, send order confirmation with order number and status. Actions must be idempotent - safe to retry on failure. Acceptance criteria: Each action sends appropriate message type, cart operations atomic, payment methods handled, orders created correctly, all actions have error handling.
