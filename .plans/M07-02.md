# M07-02 â€” API Integration Tests & Mocks

Create mock server and integration tests for external APIs. Create class WCH_API_Mock_Server using Brain Monkey for HTTP mocking. Mock WhatsApp Cloud API responses: POST /messages success: {messages: [{id: 'wamid.xxx'}]}, POST /messages rate limit: 429 with Retry-After header, POST /messages invalid recipient: {error: {code: 131026, message: 'Recipient not valid'}}, GET /media success: binary data, POST /{catalog_id}/products success: {id: 'catalog_item_id'}. Mock WooCommerce REST API responses: GET /products success: product array, POST /orders success: order object, Webhook signature validation. Create test class WCH_WhatsApp_API_Integration_Test: test_send_text_message_success(), test_send_interactive_list_success(), test_send_template_message_success(), test_rate_limit_retry_succeeds(), test_invalid_recipient_throws_exception(), test_media_upload_success(), test_catalog_sync_success(). Create test class WCH_Webhook_Integration_Test: test_webhook_verification_valid_token(), test_webhook_verification_invalid_token(), test_webhook_signature_validation_success(), test_webhook_signature_validation_failure(), test_incoming_text_message_processed(), test_incoming_interactive_response_processed(), test_message_status_update_processed(), test_duplicate_message_ignored(). Create test class WCH_WooCommerce_Integration_Test: test_product_sync_creates_catalog_item(), test_order_creation_from_cart(), test_inventory_sync_on_stock_change(), test_order_status_triggers_notification(). Performance tests: test_message_handling_under_100ms(), test_bulk_product_sync_handles_1000_products(), test_concurrent_conversations_handled(). Create GitHub Actions workflow .github/workflows/tests.yml: Run on push and PR, Matrix testing PHP 8.1, 8.2, 8.3, WordPress latest and latest-1, WooCommerce latest and latest-1, Upload coverage reports. Acceptance criteria: All API interactions have mock tests, error scenarios covered, CI pipeline runs tests automatically, performance benchmarks established.
