# M04-04 â€” Payment Gateway Integrations

Create payment processing integrations for supported methods. Create interface WCH_Payment_Gateway: get_id(), get_title(), is_available($country), process_payment($order_id, $conversation), handle_callback($data), get_payment_status($transaction_id). Implement WCH_Payment_COD: Simple confirmation, adds COD fee to order if configured, order status stays 'pending', completes on delivery. Implement WCH_Payment_Stripe: Generate Stripe Checkout session with order items, send payment link message, handle webhook for payment_intent.succeeded to update order, support card and local payment methods. Implement WCH_Payment_Razorpay (India): Generate Razorpay payment link, send to customer, handle webhook for payment.captured, support UPI, cards, netbanking. Implement WCH_Payment_WhatsAppPay: Use WhatsApp Payments API for in-app payment (where available), handle payment response in webhook. Implement WCH_Payment_PIX (Brazil): Generate PIX QR code via PagSeguro/Mercado Pago, send as image, handle confirmation webhook. Create WCH_Payment_Manager: register_gateway($gateway), get_available_gateways($country), get_gateway($id), process_order_payment($order_id, $gateway_id, $conversation). Payment failure handling: Log failure reason, send friendly error message, offer retry or alternate payment method. Refund support: Trigger original gateway refund when WC refund processed. Store payment transaction ID in order meta for reference. Acceptance criteria: All gateways process payments correctly, webhooks update order status, refunds work, failures handled gracefully, transactions logged.
