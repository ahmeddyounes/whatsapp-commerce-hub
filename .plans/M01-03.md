# M01-03 â€” Message Builder & Template Manager

Create fluent interface for building WhatsApp messages and managing templates. Create class WCH_Message_Builder with fluent methods: text($content), header($type, $content) where type is text/image/document/video, body($text), footer($text), button($type, $data) where type is reply/url/phone/flow, section($title, $rows) for list messages, product($product_id), product_list($product_ids). Method build() returns formatted array for API. Validation in build(): text max 4096 chars, header text max 60 chars, body max 1024 chars for interactive, footer max 60 chars, max 3 buttons for button messages, max 10 sections with 10 rows each for lists. Create WCH_Template_Manager for message templates. Methods: sync_templates() fetches templates from WhatsApp API and stores in option 'wch_message_templates', get_templates() returns cached templates, get_template($name) returns single template, render_template($name, $variables) replaces {{1}}, {{2}} placeholders with values. Template categories to support: order_confirmation, order_status_update, shipping_update, abandoned_cart, promotional. Create admin UI page 'Message Templates' showing: synced templates with status (approved/pending/rejected), preview with variable placeholders, last sync timestamp, sync button. Store template usage stats in transient for analytics. Acceptance criteria: Message builder validates all constraints, templates sync from API, variables render correctly, admin can view and preview templates, invalid messages throw descriptive errors.
