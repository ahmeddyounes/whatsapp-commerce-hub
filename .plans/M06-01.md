# M06-01 â€” Order Notification Templates System

Create templated notification system for order lifecycle events. Create class WCH_Order_Notifications. Register WooCommerce hooks: 'woocommerce_order_status_changed' for status notifications, 'woocommerce_new_order' for confirmation (WhatsApp orders only), 'woocommerce_shipment_tracking_info_added' for shipping updates (if Shipment Tracking plugin). Method send_order_confirmation($order_id): Get order, extract customer phone from billing or WCH meta, build template variables: {customer_name, order_number, order_total, item_count, estimated_delivery}, send using approved WhatsApp template 'order_confirmation'. Method send_status_update($order_id, $new_status): Map WC status to customer-friendly text, build variables: {order_number, status_text, status_emoji, action_needed}, select template based on status (processing, shipped, completed, cancelled, refunded), send notification. Method send_shipping_update($order_id, $tracking_number, $carrier): Build variables: {order_number, carrier_name, tracking_number, tracking_url}, send 'shipping_update' template with tracking link button. Method send_delivery_confirmation($order_id): Send when status becomes 'completed', include review request link if WC reviews enabled. Create notification preferences: Per-customer opt-out stored in WCH profile, Global toggles in settings per notification type, Quiet hours (don't send between 10pm-8am customer local time). Notification queue: Don't send immediately, queue for 30 seconds to allow order data to settle, batch multiple status changes into single notification. Retry logic: 3 attempts with 5-minute intervals if send fails. Log all notifications sent in wch_notification_log table. Admin order page metabox: Show notification history for order with sent/delivered/read status. Acceptance criteria: All order events trigger correct notifications, templates render correctly, quiet hours respected, retries work, notification history visible.
