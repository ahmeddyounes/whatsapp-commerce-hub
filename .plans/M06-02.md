# M06-02 â€” Abandoned Cart Recovery System

Create automated abandoned cart recovery via WhatsApp. Create class WCH_Abandoned_Cart_Recovery. Define abandoned cart: Cart with items, no order created, last activity older than threshold (configurable, default 4 hours). Scheduled task via Action Scheduler: Run every 30 minutes, query wch_carts where updated_at < (now - threshold) AND reminder_sent = false AND items not empty. Recovery sequence (configurable): First reminder at 4 hours, Second reminder at 24 hours (if first not converted), Final reminder at 48 hours with discount offer (optional). Method send_recovery_message($cart, $sequence_number): Build template variables: {customer_name, item_count, cart_total, top_item_name, top_item_image}, add personalized discount code if sequence 3 and setting enabled (generate unique single-use WC coupon), include View Cart deep link, send appropriate template based on sequence. Track in cart meta: reminder_1_sent_at, reminder_2_sent_at, reminder_3_sent_at, recovery_coupon_code. Conversion tracking: When order placed, check if cart had recovery messages sent, mark as recovered, attribute revenue to recovery campaign. Stop sequence immediately when: Customer replies (any message), Customer completes purchase, Customer opts out, Cart is modified (reset sequence). Admin dashboard widget: Abandoned carts (last 7 days), Recovery messages sent, Carts recovered, Recovery rate percentage, Revenue recovered. Settings: Enable/disable recovery, Delays for each sequence, Enable discount on final reminder, Discount type (percentage/fixed) and amount, Recovery message templates selection. A/B testing: Optionally split audience for different message variants, track performance by variant. Acceptance criteria: Abandoned carts detected correctly, sequences send at right times, conversions attributed, stops on customer action, stats accurate.
