# M02-03 â€” Inventory Real-time Sync Handler

Create real-time inventory synchronization. Create class WCH_Inventory_Sync_Handler. Hook on 'woocommerce_product_set_stock' and 'woocommerce_variation_set_stock'. Method handle_stock_change($product): Get new stock quantity. If stock <= 0 and was >0: update WhatsApp catalog availability to 'out_of_stock'. If stock >0 and was <=0: update to 'in_stock'. If low stock threshold reached (WC setting): optionally notify subscribed customers via broadcast. Use debouncing: store pending sync in transient for 5 seconds before executing (prevents multiple API calls during bulk updates). Method sync_stock_from_woocommerce($product_id): One-way push current stock status to WhatsApp. Method handle_order_stock_reduction($order_id): After order placed, check all ordered products' stock and update catalog if any went out of stock. Create stock discrepancy detector: daily cron comparing WC stock with WhatsApp catalog, log discrepancies, optionally auto-fix. Admin settings: enable_realtime_sync (bool), low_stock_threshold (int), notify_low_stock (bool), auto_fix_discrepancies (bool). Dashboard widget showing: products in sync, out of sync count, last sync time, sync errors. Acceptance criteria: Stock changes reflected in catalog within 10 seconds, out of stock products unavailable in WhatsApp, bulk updates debounced, discrepancies detected and logged.
