# M07-01 â€” PHPUnit Test Suite Setup

Create comprehensive test infrastructure for the plugin. Create directory /tests with structure: /tests/bootstrap.php, /tests/Unit, /tests/Integration, /tests/fixtures. Configure PHPUnit with phpunit.xml.dist: Test suites for Unit and Integration, Bootstrap file path, Coverage report configuration (HTML and Clover), Strict mode enabled. Bootstrap.php setup: Load WordPress test library from WP_TESTS_DIR, Load WooCommerce testing framework, Activate plugin programmatically, Set up test database tables. Create abstract class WCH_Unit_Test_Case extending WP_UnitTestCase: setUp() initializing common mocks, tearDown() cleanup, Helper method create_test_product() returning WC_Product, Helper method create_test_order() returning WC_Order, Helper method create_test_conversation() returning conversation ID, Mock factory for WCH_WhatsApp_API_Client. Create WCH_Integration_Test_Case extending WCH_Unit_Test_Case: setUp() with real database tables, HTTP mocking using Brain Monkey or similar. Unit tests to create (/tests/Unit/): WCH_Settings_Test - get/set/encryption, WCH_Message_Builder_Test - all message types and validation, WCH_Intent_Classifier_Test - all intents with various phrasings, WCH_Cart_Manager_Test - all CRUD operations, WCH_Conversation_FSM_Test - all state transitions, WCH_Customer_Service_Test - profile operations. Integration tests (/tests/Integration/): WCH_Product_Sync_Test - sync to catalog API, WCH_Order_Sync_Test - order creation flow, WCH_Checkout_Test - full checkout flow, WCH_Webhook_Test - webhook processing, WCH_Payment_Test - payment gateway flows. Test fixtures: Sample webhook payloads, Sample product data, Sample conversation contexts. Acceptance criteria: Tests run via 'composer test', >80% code coverage target, CI/CD pipeline integration ready, mocks isolate external dependencies.
