# M00-04 â€” REST API Base Controller & Authentication

Create REST API infrastructure for admin and external integrations. Register REST namespace 'wch/v1' using register_rest_route in rest_api_init hook. Create abstract class WCH_REST_Controller extending WP_REST_Controller with methods: register_routes() abstract, get_item_schema() abstract, check_admin_permission() returns current_user_can('manage_woocommerce'), validate_phone($phone) returns sanitized E.164 format or WP_Error, prepare_response($data, $request), add_pagination_headers($response, $total, $per_page, $page). Create authentication methods: check_api_key_permission() validates X-WCH-API-Key header against stored hash, check_webhook_signature() validates X-Hub-Signature-256 header using webhook secret. Register endpoints structure: /settings (GET/POST admin), /conversations (GET/POST), /conversations/{id} (GET/PATCH), /conversations/{id}/messages (GET/POST), /customers (GET), /customers/{phone} (GET/PATCH), /analytics (GET), /broadcasts (GET/POST), /broadcasts/{id} (GET/PATCH/DELETE), /webhook (POST public for WhatsApp callbacks). Apply rate limiting using transients: 100 requests/minute for admin endpoints, 1000 requests/minute for webhook. Return standardized error responses with code, message, and details. Acceptance criteria: All endpoints require authentication except webhook, rate limiting blocks excessive requests with 429 response, responses follow WP REST API conventions, OpenAPI/Swagger compatible.
