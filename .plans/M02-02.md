# M02-02 â€” WooCommerce Order Sync Service

Create order synchronization from WhatsApp to WooCommerce. Create class WCH_Order_Sync_Service. Method create_order_from_cart($cart_data, $customer_phone): Validate cart items still in stock, create WC_Order programmatically with: billing/shipping from cart shipping_address, payment_method from cart, line items from cart items with current prices, apply coupon if present, calculate totals. Set order meta: '_wch_order' = true, '_wch_conversation_id', '_wch_customer_phone'. Set order status based on payment: 'pending' for COD, 'processing' for paid. Reduce stock via wc_reduce_stock_levels(). Return order_id or throw exception with reason. Method sync_order_status_to_whatsapp($order_id, $old_status, $new_status): Hook on 'woocommerce_order_status_changed'. Map WC status to notification template: pending->processing = 'order_confirmed', processing->completed = 'order_completed', processing->shipped = 'shipping_update' (if tracking), any->cancelled/refunded = 'order_cancelled'. Queue notification via WCH_Queue. Method add_tracking_info($order_id, $tracking_number, $carrier): Store in order meta, trigger shipping_update notification. Create order notes integration: add WCH conversation link to order notes, show WhatsApp icon in orders list. Admin order page metabox: show conversation history link, customer WhatsApp profile, quick reply button opening modal. Filter orders by WhatsApp source using custom query var. Acceptance criteria: Orders created with all data correctly mapped, stock reduced atomically, status changes trigger appropriate notifications, admin can filter and manage WhatsApp orders.
