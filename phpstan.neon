includes:
	- vendor/szepeviktor/phpstan-wordpress/extension.neon
	- phpstan-baseline.neon

# Custom rules for Domain layer purity
rules:
	- WhatsAppCommerceHub\PHPStan\Rules\NoWordPressFunctionsInDomainRule
	- WhatsAppCommerceHub\PHPStan\Rules\NoWordPressGlobalsInDomainRule
	- WhatsAppCommerceHub\PHPStan\Rules\NoWchCallsInProvidersRule

parameters:
	level: 5
	paths:
		- includes
		- whatsapp-commerce-hub.php

	# Parallel processing - disable to reduce memory usage
	# Note: Run with --memory-limit=1G if analysis fails
	parallel:
		maximumNumberOfProcesses: 1

	# Exclude patterns
	excludePaths:
		- includes/class-wch-test.php
		- includes/class-wch-settings-test.php
		- includes/class-wch-rest-api-test.php

	# WordPress and WooCommerce stubs
	scanFiles:
		- vendor/php-stubs/wordpress-stubs/wordpress-stubs.php
		- vendor/php-stubs/woocommerce-stubs/woocommerce-stubs.php
		- stubs/action-scheduler.php
		- stubs/constants.php

	# Enable broader analysis
	polluteScopeWithLoopInitialAssignments: true
	polluteScopeWithAlwaysIterableForeach: true
	checkAlwaysTrueCheckTypeFunctionCall: true
	checkAlwaysTrueInstanceof: true
	checkAlwaysTrueStrictComparison: true
	checkExplicitMixedMissingReturn: true
	checkFunctionNameCase: true
	checkInternalClassCaseSensitivity: true
